-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.abertura_exponencial (
  id integer NOT NULL DEFAULT nextval('abertura_exponencial_id_seq'::regclass),
  paciente_id character varying,
  identificacao text,
  motivo_consulta text,
  queixas jsonb,
  queixa_principal text,
  expectativas text,
  contexto_emocional text,
  timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT abertura_exponencial_pkey PRIMARY KEY (id),
  CONSTRAINT abertura_exponencial_paciente_id_fkey FOREIGN KEY (paciente_id) REFERENCES public.pacientes(id)
);
CREATE TABLE public.ai_assessment_scores (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  assessment_id text,
  patient_id uuid,
  completed boolean NOT NULL DEFAULT false,
  phases_completed integer NOT NULL DEFAULT 0,
  total_phases integer NOT NULL DEFAULT 10,
  score numeric NOT NULL DEFAULT 0,
  stuck_at_phase text,
  completion_time_seconds integer,
  error_message text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  simulation_id text,
  CONSTRAINT ai_assessment_scores_pkey PRIMARY KEY (id),
  CONSTRAINT ai_assessment_scores_assessment_id_fkey FOREIGN KEY (assessment_id) REFERENCES public.clinical_reports(id),
  CONSTRAINT ai_assessment_scores_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id)
);
CREATE TABLE public.ai_chat_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  session_id text,
  message text NOT NULL,
  response text,
  role text NOT NULL CHECK (role = ANY (ARRAY['user'::text, 'assistant'::text, 'system'::text])),
  model text,
  tokens_used integer,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_chat_history_pkey PRIMARY KEY (id),
  CONSTRAINT ai_chat_history_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.ai_chat_interactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  patient_id uuid,
  session_id uuid,
  user_message text NOT NULL,
  ai_response text NOT NULL,
  intent text,
  confidence numeric,
  processing_time integer,
  metadata jsonb,
  saved_to_medical_record boolean DEFAULT false,
  medical_record_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_chat_interactions_pkey PRIMARY KEY (id),
  CONSTRAINT ai_chat_interactions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT ai_chat_interactions_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT ai_chat_interactions_medical_record_id_fkey FOREIGN KEY (medical_record_id) REFERENCES public.patient_medical_records(id)
);
CREATE TABLE public.ai_saved_documents (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  patient_id uuid,
  document_type text NOT NULL CHECK (document_type = ANY (ARRAY['assessment_report'::text, 'clinical_note'::text, 'prescription'::text, 'summary'::text, 'insight'::text, 'recommendation'::text, 'analysis'::text])),
  title text NOT NULL,
  content text NOT NULL,
  summary text,
  metadata jsonb,
  file_url text,
  file_type text,
  is_shared_with_patient boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_saved_documents_pkey PRIMARY KEY (id),
  CONSTRAINT ai_saved_documents_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT ai_saved_documents_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id)
);
CREATE TABLE public.ai_scheduling_predictions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  appointment_id uuid,
  no_show_probability numeric,
  expected_duration_minutes integer,
  recommended_action text,
  model_version text,
  predicted_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_scheduling_predictions_pkey PRIMARY KEY (id),
  CONSTRAINT ai_scheduling_predictions_appointment_id_fkey FOREIGN KEY (appointment_id) REFERENCES public.appointments(id)
);
CREATE TABLE public.analytics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  metric_type character varying NOT NULL,
  metric_name character varying NOT NULL,
  metric_value numeric,
  metric_unit character varying,
  context jsonb,
  timestamp timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT analytics_pkey PRIMARY KEY (id),
  CONSTRAINT analytics_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.appointments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid,
  professional_id uuid,
  title text NOT NULL DEFAULT 'Agendamento ClÃ­nico'::text,
  description text,
  appointment_date timestamp with time zone NOT NULL,
  duration integer DEFAULT 60,
  status character varying DEFAULT 'scheduled'::character varying CHECK (status::text = ANY (ARRAY['scheduled'::character varying, 'confirmed'::character varying, 'completed'::character varying, 'cancelled'::character varying, 'no_show'::character varying]::text[])),
  type character varying DEFAULT 'consultation'::character varying,
  location text,
  is_remote boolean DEFAULT false,
  meeting_url text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  doctor_id uuid,
  notes text,
  appointment_time text,
  specialty text,
  appointment_type text,
  professional_name text,
  CONSTRAINT appointments_pkey PRIMARY KEY (id)
);
CREATE TABLE public.assessment_sharing (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  assessment_id uuid,
  patient_id uuid,
  shared_with_ricardo_valenca boolean DEFAULT false,
  shared_with_eduardo_faveret boolean DEFAULT false,
  patient_consent boolean DEFAULT false,
  consent_date timestamp with time zone,
  consent_expiry_date timestamp with time zone,
  shared_at timestamp with time zone DEFAULT now(),
  shared_by uuid,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT assessment_sharing_pkey PRIMARY KEY (id),
  CONSTRAINT assessment_sharing_assessment_id_fkey FOREIGN KEY (assessment_id) REFERENCES public.imre_assessments(id),
  CONSTRAINT assessment_sharing_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT assessment_sharing_shared_by_fkey FOREIGN KEY (shared_by) REFERENCES auth.users(id)
);
CREATE TABLE public.avaliacoes_renais (
  id integer NOT NULL DEFAULT nextval('avaliacoes_renais_id_seq'::regclass),
  paciente_id character varying,
  creatinina numeric,
  egfr numeric,
  acr numeric,
  eletrolitos jsonb,
  glicose numeric,
  ureia numeric,
  acido_urico numeric,
  ultrassom_renal text,
  risco_drc character varying CHECK (risco_drc::text = ANY (ARRAY['baixo'::character varying, 'moderado'::character varying, 'alto'::character varying, 'muito_alto'::character varying]::text[])),
  timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT avaliacoes_renais_pkey PRIMARY KEY (id),
  CONSTRAINT avaliacoes_renais_paciente_id_fkey FOREIGN KEY (paciente_id) REFERENCES public.pacientes(id)
);
CREATE TABLE public.base_conhecimento (
  id character varying NOT NULL,
  categoria character varying NOT NULL,
  titulo character varying NOT NULL,
  conteudo text NOT NULL,
  tags jsonb,
  versao character varying NOT NULL,
  data_atualizacao timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  autor character varying NOT NULL,
  prioridade character varying DEFAULT 'media'::character varying CHECK (prioridade::text = ANY (ARRAY['alta'::character varying, 'media'::character varying, 'baixa'::character varying]::text[])),
  ativo boolean DEFAULT true,
  CONSTRAINT base_conhecimento_pkey PRIMARY KEY (id)
);
CREATE TABLE public.benefit_usage_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  benefit_type text NOT NULL,
  details jsonb DEFAULT '{}'::jsonb,
  value_monetary numeric,
  used_at timestamp with time zone DEFAULT now(),
  CONSTRAINT benefit_usage_log_pkey PRIMARY KEY (id),
  CONSTRAINT benefit_usage_log_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.cfm_prescriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  prescription_type text NOT NULL,
  patient_id uuid,
  patient_name text NOT NULL,
  patient_cpf text,
  patient_email text,
  patient_phone text,
  professional_id uuid NOT NULL,
  professional_name text NOT NULL,
  professional_crm text,
  professional_specialty text,
  medications jsonb DEFAULT '[]'::jsonb,
  notes text,
  status text DEFAULT 'draft'::text,
  digital_signature text,
  signature_certificate text,
  signature_timestamp timestamp with time zone,
  iti_validation_code text,
  iti_validation_url text,
  iti_qr_code text,
  sent_at timestamp with time zone,
  sent_via_email boolean DEFAULT false,
  sent_via_sms boolean DEFAULT false,
  email_sent_at timestamp with time zone,
  sms_sent_at timestamp with time zone,
  expires_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  document_level text DEFAULT 'level_3'::text CHECK (document_level = ANY (ARRAY['level_1'::text, 'level_2'::text, 'level_3'::text])),
  CONSTRAINT cfm_prescriptions_pkey PRIMARY KEY (id),
  CONSTRAINT cfm_prescriptions_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.users(id)
);
CREATE TABLE public.channels (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  type text DEFAULT 'public'::text CHECK (type = ANY (ARRAY['public'::text, 'private'::text])),
  created_by uuid,
  members_count integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT channels_pkey PRIMARY KEY (id)
);
CREATE TABLE public.chat_messages (
  id bigint NOT NULL DEFAULT nextval('chat_messages_id_seq'::regclass),
  room_id uuid,
  sender_id uuid,
  message text,
  message_type text DEFAULT 'text'::text CHECK (message_type = ANY (ARRAY['text'::text, 'file'::text, 'system'::text])),
  file_url text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  read_at timestamp with time zone,
  CONSTRAINT chat_messages_pkey PRIMARY KEY (id),
  CONSTRAINT chat_messages_room_id_fkey FOREIGN KEY (room_id) REFERENCES public.chat_rooms(id),
  CONSTRAINT chat_messages_sender_id_fkey1 FOREIGN KEY (sender_id) REFERENCES auth.users(id)
);
CREATE TABLE public.chat_messages_legacy (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  content text NOT NULL,
  channel text DEFAULT 'general'::text,
  is_pinned boolean DEFAULT false,
  is_deleted boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  expires_at timestamp with time zone DEFAULT (now() + '24:00:00'::interval),
  user_name text,
  user_avatar text DEFAULT 'U'::text,
  crm text,
  specialty text,
  type text DEFAULT 'text'::text,
  reactions jsonb DEFAULT '{"heart": 0, "reply": 0, "thumbs": 0}'::jsonb,
  is_online boolean DEFAULT true,
  sender_name text,
  sender_email text,
  sender_id uuid,
  chat_id uuid NOT NULL,
  CONSTRAINT chat_messages_legacy_pkey PRIMARY KEY (id),
  CONSTRAINT chat_messages_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES auth.users(id)
);
CREATE TABLE public.chat_participants (
  room_id uuid NOT NULL,
  user_id uuid NOT NULL,
  role text DEFAULT 'professional'::text CHECK (role = ANY (ARRAY['admin'::text, 'professional'::text, 'patient'::text, 'student'::text])),
  last_seen_at timestamp with time zone,
  joined_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT chat_participants_pkey PRIMARY KEY (room_id, user_id),
  CONSTRAINT chat_participants_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT chat_participants_room_id_fkey FOREIGN KEY (room_id) REFERENCES public.chat_rooms(id)
);
CREATE TABLE public.chat_rooms (
  id uuid NOT NULL DEFAULT extensions.gen_random_uuid(),
  name text,
  type text DEFAULT 'professional'::text CHECK (type = ANY (ARRAY['professional'::text, 'patient'::text, 'classroom'::text, 'admin'::text])),
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT chat_rooms_pkey PRIMARY KEY (id),
  CONSTRAINT chat_rooms_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.chat_sessions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  context_docs ARRAY DEFAULT '{}'::uuid[],
  messages jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT chat_sessions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.clinical_assessments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid,
  doctor_id uuid,
  assessment_type text,
  data jsonb DEFAULT '{}'::jsonb,
  status text DEFAULT 'in_progress'::text CHECK (status = ANY (ARRAY['in_progress'::text, 'completed'::text, 'reviewed'::text])),
  created_at timestamp with time zone DEFAULT now(),
  clinical_report text,
  updated_at timestamp with time zone DEFAULT now(),
  appointment_id uuid,
  CONSTRAINT clinical_assessments_pkey PRIMARY KEY (id),
  CONSTRAINT clinical_assessments_appointment_id_fkey FOREIGN KEY (appointment_id) REFERENCES public.appointments(id),
  CONSTRAINT clinical_assessments_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.users(id)
);
CREATE TABLE public.clinical_integration (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  assessment_id uuid,
  clinical_data jsonb NOT NULL,
  therapeutic_recommendations jsonb,
  risk_assessment jsonb,
  follow_up_plan jsonb,
  integration_date timestamp with time zone DEFAULT now(),
  clinician_notes text,
  status character varying DEFAULT 'active'::character varying,
  CONSTRAINT clinical_integration_pkey PRIMARY KEY (id),
  CONSTRAINT clinical_integration_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT clinical_integration_assessment_id_fkey FOREIGN KEY (assessment_id) REFERENCES public.imre_assessments(id)
);
CREATE TABLE public.clinical_kpis (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid,
  doctor_id uuid,
  category text NOT NULL CHECK (category = ANY (ARRAY['comportamental'::text, 'cognitivo'::text, 'social'::text, 'fisico'::text, 'emocional'::text])),
  metric_name text NOT NULL,
  metric_value numeric NOT NULL,
  metric_unit text,
  assessment_date date NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  professional_id uuid,
  CONSTRAINT clinical_kpis_pkey PRIMARY KEY (id),
  CONSTRAINT clinical_kpis_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id),
  CONSTRAINT clinical_kpis_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT clinical_kpis_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES auth.users(id)
);
CREATE TABLE public.clinical_reports (
  id text NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  patient_name text NOT NULL,
  report_type text NOT NULL DEFAULT 'initial_assessment'::text CHECK (report_type = ANY (ARRAY['initial_assessment'::text, 'follow_up'::text, 'emergency'::text])),
  protocol text NOT NULL DEFAULT 'IMRE'::text,
  content jsonb NOT NULL,
  generated_by text NOT NULL CHECK (generated_by = ANY (ARRAY['noa_ai'::text, 'professional'::text, 'system'::text])),
  generated_at timestamp with time zone NOT NULL DEFAULT now(),
  status text NOT NULL DEFAULT 'completed'::text CHECK (status = ANY (ARRAY['draft'::text, 'completed'::text, 'reviewed'::text])),
  professional_id uuid,
  professional_name text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  doctor_id uuid,
  shared_with ARRAY DEFAULT ARRAY[]::uuid[],
  shared_at timestamp with time zone,
  shared_by uuid,
  assessment_id uuid,
  CONSTRAINT clinical_reports_pkey PRIMARY KEY (id),
  CONSTRAINT clinical_reports_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES auth.users(id),
  CONSTRAINT clinical_reports_shared_by_fkey FOREIGN KEY (shared_by) REFERENCES auth.users(id),
  CONSTRAINT clinical_reports_assessment_id_fkey FOREIGN KEY (assessment_id) REFERENCES public.clinical_assessments(id)
);
CREATE TABLE public.clinics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  doctor_id uuid UNIQUE,
  description text,
  is_active boolean DEFAULT true,
  settings jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT clinics_pkey PRIMARY KEY (id),
  CONSTRAINT clinics_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES auth.users(id)
);
CREATE TABLE public.cognitive_decisions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  decision_type text NOT NULL,
  recommendation jsonb NOT NULL,
  justification text,
  alternatives jsonb,
  confidence double precision,
  autonomy_level integer DEFAULT 1,
  requires_human_confirmation boolean DEFAULT true,
  human_feedback text,
  human_notes text,
  policy_snapshot jsonb,
  model_version text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT cognitive_decisions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.cognitive_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  intent text NOT NULL,
  action text NOT NULL,
  decision_result text NOT NULL,
  source text NOT NULL,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT cognitive_events_pkey PRIMARY KEY (id)
);
CREATE TABLE public.cognitive_interaction_state (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  depth_level integer NOT NULL DEFAULT 0,
  traits jsonb NOT NULL DEFAULT '{}'::jsonb,
  last_shift_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT cognitive_interaction_state_pkey PRIMARY KEY (id),
  CONSTRAINT cognitive_interaction_state_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.cognitive_metabolism (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  professional_id text NOT NULL UNIQUE,
  decision_count_today integer DEFAULT 0,
  decision_limit_daily integer DEFAULT 100,
  last_reset_at timestamp with time zone DEFAULT now(),
  CONSTRAINT cognitive_metabolism_pkey PRIMARY KEY (id)
);
CREATE TABLE public.cognitive_policies (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  intent text NOT NULL,
  autonomy_level integer DEFAULT 1,
  forbidden_actions ARRAY,
  active boolean DEFAULT true,
  version integer DEFAULT 1,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT cognitive_policies_pkey PRIMARY KEY (id)
);
CREATE TABLE public.contexto_longitudinal (
  id integer NOT NULL DEFAULT nextval('contexto_longitudinal_id_seq'::regclass),
  paciente_id character varying,
  evolucao_sintomas jsonb,
  evolucao_medicamentos jsonb,
  evolucao_exames jsonb,
  consultas_profissionais jsonb,
  timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT contexto_longitudinal_pkey PRIMARY KEY (id),
  CONSTRAINT contexto_longitudinal_paciente_id_fkey FOREIGN KEY (paciente_id) REFERENCES public.pacientes(id)
);
CREATE TABLE public.conversation_ratings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  professional_id uuid,
  context text NOT NULL DEFAULT 'noa'::text CHECK (context = ANY (ARRAY['noa'::text, 'professional'::text, 'consultation'::text])),
  rating smallint NOT NULL CHECK (rating >= 1 AND rating <= 5),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT conversation_ratings_pkey PRIMARY KEY (id),
  CONSTRAINT conversation_ratings_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT conversation_ratings_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id)
);
CREATE TABLE public.course_enrollments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  course_id uuid,
  user_id uuid,
  progress numeric DEFAULT 0,
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  status text DEFAULT 'in_progress'::text CHECK (status = ANY (ARRAY['in_progress'::text, 'completed'::text, 'dropped'::text])),
  enrolled_at timestamp with time zone DEFAULT now(),
  CONSTRAINT course_enrollments_pkey PRIMARY KEY (id),
  CONSTRAINT course_enrollments_course_id_fkey FOREIGN KEY (course_id) REFERENCES public.courses(id)
);
CREATE TABLE public.course_modules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  course_id uuid,
  title text NOT NULL,
  description text,
  content text,
  order_index integer NOT NULL,
  duration integer,
  content_type character varying DEFAULT 'video'::character varying,
  content_url text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT course_modules_pkey PRIMARY KEY (id),
  CONSTRAINT course_modules_course_id_fkey FOREIGN KEY (course_id) REFERENCES public.courses(id)
);
CREATE TABLE public.course_ratings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  course_id uuid NOT NULL,
  user_id uuid NOT NULL,
  rating numeric NOT NULL CHECK (rating >= 1::numeric AND rating <= 5::numeric),
  comment text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT course_ratings_pkey PRIMARY KEY (id),
  CONSTRAINT course_ratings_course_id_fkey FOREIGN KEY (course_id) REFERENCES public.courses(id),
  CONSTRAINT course_ratings_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.courses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  description text,
  category text,
  level text CHECK (level = ANY (ARRAY['beginner'::text, 'intermediate'::text, 'advanced'::text])),
  duration integer,
  price numeric DEFAULT 0,
  is_active boolean DEFAULT true,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  content text,
  difficulty character varying DEFAULT 'beginner'::character varying,
  tags ARRAY,
  is_published boolean DEFAULT false,
  is_featured boolean DEFAULT false,
  updated_at timestamp with time zone DEFAULT now(),
  original_price numeric,
  instructor text,
  is_live boolean DEFAULT false,
  next_class_date timestamp with time zone,
  slug text,
  duration_text text,
  CONSTRAINT courses_pkey PRIMARY KEY (id)
);
CREATE TABLE public.dados_imre_coletados (
  id integer NOT NULL DEFAULT nextval('dados_imre_coletados_id_seq'::regclass),
  paciente_id character varying,
  bloco_id integer NOT NULL,
  pergunta text NOT NULL,
  resposta text NOT NULL,
  timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT dados_imre_coletados_pkey PRIMARY KEY (id),
  CONSTRAINT dados_imre_coletados_paciente_id_fkey FOREIGN KEY (paciente_id) REFERENCES public.pacientes(id)
);
CREATE TABLE public.debates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  description text,
  author_id uuid,
  category text,
  tags ARRAY,
  is_active boolean DEFAULT true,
  is_password_protected boolean DEFAULT false,
  password text,
  participants_count integer DEFAULT 0,
  views integer DEFAULT 0,
  votes jsonb DEFAULT '{"up": 0, "down": 0}'::jsonb,
  is_pinned boolean DEFAULT false,
  is_hot boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT debates_pkey PRIMARY KEY (id)
);
CREATE TABLE public.desenvolvimento_indiciario (
  id integer NOT NULL DEFAULT nextval('desenvolvimento_indiciario_id_seq'::regclass),
  paciente_id character varying,
  hda_inicio text,
  hda_evolucao text,
  hda_caracteristicas text,
  hda_fatores_moduladores text,
  hda_impacto_funcional text,
  hda_tratamentos_anteriores jsonb,
  historia_doencas_previas jsonb,
  historia_cirurgias jsonb,
  historia_hospitalizacoes jsonb,
  historia_familiar_doencas jsonb,
  historia_familiar_padroes jsonb,
  alergias_medicamentos jsonb,
  alergias_alimentos jsonb,
  alergias_outras jsonb,
  habitos_alimentacao text,
  habitos_sono text,
  habitos_exercicios text,
  habitos_trabalho text,
  habitos_contexto_social text,
  medicamentos_atuais jsonb,
  medicamentos_anteriores jsonb,
  medicamentos_suplementos jsonb,
  timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT desenvolvimento_indiciario_pkey PRIMARY KEY (id),
  CONSTRAINT desenvolvimento_indiciario_paciente_id_fkey FOREIGN KEY (paciente_id) REFERENCES public.pacientes(id)
);
CREATE TABLE public.dev_vivo_audit (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  change_id uuid,
  action text NOT NULL CHECK (action = ANY (ARRAY['create'::text, 'read'::text, 'update'::text, 'delete'::text])),
  data_type text CHECK (data_type = ANY (ARRAY['user_data'::text, 'code'::text, 'config'::text, 'database'::text])),
  user_id uuid,
  ip_address inet,
  user_agent text,
  request_body jsonb,
  response_status integer,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT dev_vivo_audit_pkey PRIMARY KEY (id),
  CONSTRAINT dev_vivo_audit_change_id_fkey FOREIGN KEY (change_id) REFERENCES public.dev_vivo_changes(id),
  CONSTRAINT dev_vivo_audit_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.dev_vivo_changes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  session_id text NOT NULL,
  change_type text NOT NULL CHECK (change_type = ANY (ARRAY['create'::text, 'update'::text, 'delete'::text, 'patch'::text])),
  file_path text NOT NULL,
  old_content text,
  new_content text,
  reason text,
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'applied'::text, 'rolled_back'::text, 'failed'::text])),
  applied_at timestamp with time zone,
  rolled_back_at timestamp with time zone,
  rollback_reason text,
  signature text,
  error_message text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT dev_vivo_changes_pkey PRIMARY KEY (id),
  CONSTRAINT dev_vivo_changes_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.dev_vivo_diagnostics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_id text NOT NULL,
  current_route text,
  route_params jsonb,
  query_params jsonb,
  current_component text,
  component_props jsonb,
  component_state jsonb,
  recent_errors jsonb,
  recent_warnings jsonb,
  supabase_connections jsonb,
  api_calls jsonb,
  realtime_subscriptions jsonb,
  render_time numeric,
  memory_usage numeric,
  network_latency numeric,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT dev_vivo_diagnostics_pkey PRIMARY KEY (id)
);
CREATE TABLE public.dev_vivo_sessions (
  id text NOT NULL,
  user_id uuid NOT NULL,
  supabase_token text NOT NULL,
  flag_admin boolean DEFAULT false,
  can_modify_code boolean DEFAULT false,
  can_modify_database boolean DEFAULT false,
  can_access_real_data boolean DEFAULT false,
  current_route text,
  current_component text,
  is_active boolean DEFAULT true,
  expires_at timestamp with time zone NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT dev_vivo_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT dev_vivo_sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.document_snapshots (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  document_id uuid NOT NULL,
  version_hash text NOT NULL,
  pdf_url text,
  pdf_storage_path text,
  is_final boolean DEFAULT false,
  snapshot_data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT document_snapshots_pkey PRIMARY KEY (id),
  CONSTRAINT document_snapshots_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.cfm_prescriptions(id)
);
CREATE TABLE public.documents (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  content text,
  summary text,
  keywords ARRAY DEFAULT '{}'::text[],
  medical_terms ARRAY DEFAULT '{}'::text[],
  embeddings jsonb,
  file_url text,
  file_type text,
  file_size integer,
  uploaded_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  category text,
  tags ARRAY DEFAULT ARRAY[]::text[],
  target_audience ARRAY DEFAULT ARRAY[]::text[],
  author text,
  isLinkedToAI boolean DEFAULT false,
  aiRelevance numeric DEFAULT 0 CHECK ("aiRelevance" >= 0.0 AND "aiRelevance" <= 1.0),
  type text,
  downloads integer NOT NULL DEFAULT 0,
  is_published boolean DEFAULT false,
  is_featured boolean DEFAULT false,
  CONSTRAINT documents_pkey PRIMARY KEY (id)
);
CREATE TABLE public.educational_resources (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  summary text,
  description text,
  category character varying,
  resource_type character varying DEFAULT 'article'::character varying,
  url text,
  published_at timestamp with time zone DEFAULT now(),
  audience text,
  status character varying DEFAULT 'published'::character varying,
  allowed_roles ARRAY,
  role_permissions jsonb,
  allowed_axes ARRAY,
  axis_permissions jsonb,
  visibility_scope character varying DEFAULT 'public'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT educational_resources_pkey PRIMARY KEY (id)
);
CREATE TABLE public.epilepsy_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid,
  event_type character varying NOT NULL,
  severity character varying NOT NULL,
  duration integer,
  timestamp timestamp with time zone DEFAULT now(),
  triggers ARRAY DEFAULT '{}'::text[],
  medications ARRAY DEFAULT '{}'::text[],
  notes text,
  wearable_data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  event_date timestamp with time zone DEFAULT now(),
  CONSTRAINT epilepsy_events_pkey PRIMARY KEY (id),
  CONSTRAINT epilepsy_events_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id)
);
CREATE TABLE public.exam_request_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  content text NOT NULL,
  category text DEFAULT 'Geral'::text,
  is_public boolean DEFAULT false,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT exam_request_templates_pkey PRIMARY KEY (id),
  CONSTRAINT exam_request_templates_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.feature_flags (
  flag text NOT NULL,
  enabled boolean NOT NULL DEFAULT false,
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT feature_flags_pkey PRIMARY KEY (flag)
);
CREATE TABLE public.fechamento_consensual (
  id integer NOT NULL DEFAULT nextval('fechamento_consensual_id_seq'::regclass),
  paciente_id character varying,
  revisao_narrativa text,
  complementacoes jsonb,
  exames_solicitados jsonb,
  proximos_passos text,
  observacoes text,
  timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fechamento_consensual_pkey PRIMARY KEY (id),
  CONSTRAINT fechamento_consensual_paciente_id_fkey FOREIGN KEY (paciente_id) REFERENCES public.pacientes(id)
);
CREATE TABLE public.forum_comments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid NOT NULL,
  author_id uuid NOT NULL,
  content text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT forum_comments_pkey PRIMARY KEY (id),
  CONSTRAINT forum_comments_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.forum_posts(id),
  CONSTRAINT forum_comments_author_id_fkey FOREIGN KEY (author_id) REFERENCES public.users(id)
);
CREATE TABLE public.forum_likes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid NOT NULL,
  user_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT forum_likes_pkey PRIMARY KEY (id),
  CONSTRAINT forum_likes_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.forum_posts(id),
  CONSTRAINT forum_likes_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.forum_posts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  author_id uuid NOT NULL,
  title text NOT NULL,
  content text NOT NULL,
  category character varying,
  tags ARRAY,
  is_pinned boolean DEFAULT false,
  is_hot boolean DEFAULT false,
  is_active boolean DEFAULT true,
  is_password_protected boolean DEFAULT false,
  password text,
  views integer DEFAULT 0,
  votes_up integer DEFAULT 0,
  votes_down integer DEFAULT 0,
  replies_count integer DEFAULT 0,
  current_participants integer DEFAULT 0,
  max_participants integer,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  allowed_roles ARRAY DEFAULT '{}'::text[],
  post_roles ARRAY DEFAULT '{}'::text[],
  description text,
  slug text UNIQUE,
  CONSTRAINT forum_posts_pkey PRIMARY KEY (id),
  CONSTRAINT forum_posts_author_id_fkey FOREIGN KEY (author_id) REFERENCES auth.users(id)
);
CREATE TABLE public.forum_views (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid NOT NULL,
  user_id uuid NOT NULL,
  viewed_at timestamp with time zone DEFAULT now(),
  CONSTRAINT forum_views_pkey PRIMARY KEY (id),
  CONSTRAINT forum_views_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.forum_posts(id),
  CONSTRAINT forum_views_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.friendships (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  requester_id uuid,
  addressee_id uuid,
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'accepted'::text, 'blocked'::text])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT friendships_pkey PRIMARY KEY (id)
);
CREATE TABLE public.gamification_points (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  points integer NOT NULL DEFAULT 0,
  source text NOT NULL,
  source_id uuid,
  description text,
  category text CHECK (category = ANY (ARRAY['learning'::text, 'clinical'::text, 'social'::text, 'special'::text])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT gamification_points_pkey PRIMARY KEY (id),
  CONSTRAINT gamification_points_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.global_chat_messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  user_name text NOT NULL,
  user_avatar text DEFAULT 'U'::text,
  message text NOT NULL,
  channel text NOT NULL DEFAULT 'general'::text,
  crm text,
  specialty text,
  type text DEFAULT 'text'::text,
  reactions jsonb DEFAULT '{"heart": 0, "reply": 0, "thumbs": 0}'::jsonb,
  is_pinned boolean DEFAULT false,
  is_online boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT global_chat_messages_pkey PRIMARY KEY (id)
);
CREATE TABLE public.imre_assessments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  patient_id uuid,
  assessment_type character varying NOT NULL DEFAULT 'triaxial'::character varying,
  triaxial_data jsonb NOT NULL DEFAULT '{}'::jsonb,
  semantic_context jsonb NOT NULL DEFAULT '{}'::jsonb,
  emotional_indicators jsonb,
  cognitive_patterns jsonb,
  behavioral_markers jsonb,
  assessment_date timestamp with time zone DEFAULT now(),
  session_duration integer,
  completion_status character varying DEFAULT 'in_progress'::character varying CHECK (completion_status::text = ANY (ARRAY['in_progress'::character varying, 'completed'::character varying, 'abandoned'::character varying]::text[])),
  clinical_notes text,
  risk_factors jsonb,
  therapeutic_goals jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT imre_assessments_pkey PRIMARY KEY (id),
  CONSTRAINT imre_assessments_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.imre_semantic_blocks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  assessment_id uuid,
  block_number integer NOT NULL,
  block_type character varying NOT NULL,
  semantic_content jsonb NOT NULL,
  emotional_weight numeric CHECK (emotional_weight >= 0::numeric AND emotional_weight <= 1::numeric),
  cognitive_complexity numeric CHECK (cognitive_complexity >= 0::numeric AND cognitive_complexity <= 1::numeric),
  behavioral_impact numeric CHECK (behavioral_impact >= 0::numeric AND behavioral_impact <= 1::numeric),
  confidence_score numeric,
  processing_time integer,
  timestamp timestamp with time zone DEFAULT now(),
  CONSTRAINT imre_semantic_blocks_pkey PRIMARY KEY (id),
  CONSTRAINT imre_semantic_blocks_assessment_id_fkey FOREIGN KEY (assessment_id) REFERENCES public.imre_assessments(id)
);
CREATE TABLE public.imre_semantic_context (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  assessment_id uuid,
  semantic_memory jsonb NOT NULL,
  emotional_history jsonb,
  cognitive_patterns jsonb,
  behavioral_trends jsonb,
  context_version integer DEFAULT 1,
  last_updated timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT imre_semantic_context_pkey PRIMARY KEY (id),
  CONSTRAINT imre_semantic_context_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT imre_semantic_context_assessment_id_fkey FOREIGN KEY (assessment_id) REFERENCES public.imre_assessments(id)
);
CREATE TABLE public.institutional_trauma_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  restricted_mode_active boolean DEFAULT false,
  reason text,
  recovery_estimated_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  severity text,
  affected_domain text,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT institutional_trauma_log_pkey PRIMARY KEY (id)
);
CREATE TABLE public.integrative_prescription_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  slug text UNIQUE,
  name text NOT NULL,
  summary text,
  description text,
  rationality USER-DEFINED NOT NULL,
  category text,
  default_dosage text,
  default_frequency text,
  default_duration text,
  default_instructions text,
  indications ARRAY DEFAULT '{}'::text[],
  contraindications ARRAY DEFAULT '{}'::text[],
  monitoring ARRAY DEFAULT '{}'::text[],
  tags ARRAY DEFAULT '{}'::text[],
  metadata jsonb DEFAULT '{}'::jsonb,
  created_by uuid,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT integrative_prescription_templates_pkey PRIMARY KEY (id),
  CONSTRAINT integrative_prescription_templates_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.interacoes_ia (
  id integer NOT NULL DEFAULT nextval('interacoes_ia_id_seq'::regclass),
  paciente_id character varying,
  data timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  pergunta text NOT NULL,
  resposta text NOT NULL,
  contexto_utilizado text,
  satisfacao integer CHECK (satisfacao >= 1 AND satisfacao <= 5),
  timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT interacoes_ia_pkey PRIMARY KEY (id),
  CONSTRAINT interacoes_ia_paciente_id_fkey FOREIGN KEY (paciente_id) REFERENCES public.pacientes(id)
);
CREATE TABLE public.kpi_daily_snapshots (
  date date NOT NULL DEFAULT CURRENT_DATE,
  total_active_patients integer DEFAULT 0,
  total_protocols_completed integer DEFAULT 0,
  avg_engagement_score numeric DEFAULT 0,
  avg_sentiment_score numeric DEFAULT 0,
  treatment_adherence_rate numeric DEFAULT 0,
  active_wearables_count integer DEFAULT 0,
  epilepsy_episodes_today integer DEFAULT 0,
  symptom_improvement_rate numeric DEFAULT 0,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT kpi_daily_snapshots_pkey PRIMARY KEY (date)
);
CREATE TABLE public.lesson_content (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  module_id text NOT NULL,
  lesson_id text NOT NULL,
  title text NOT NULL,
  content text NOT NULL DEFAULT ''::text,
  content_type text DEFAULT 'markdown'::text CHECK (content_type = ANY (ARRAY['markdown'::text, 'html'::text, 'text'::text])),
  created_by uuid,
  updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT lesson_content_pkey PRIMARY KEY (id),
  CONSTRAINT lesson_content_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id),
  CONSTRAINT lesson_content_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES auth.users(id)
);
CREATE TABLE public.lessons (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  course_id uuid,
  module_id uuid,
  title text NOT NULL,
  description text,
  content text,
  video_url text,
  duration integer,
  order_index integer DEFAULT 0,
  lesson_type text DEFAULT 'video'::text CHECK (lesson_type = ANY (ARRAY['video'::text, 'reading'::text, 'quiz'::text, 'assignment'::text, 'interactive'::text])),
  is_published boolean DEFAULT false,
  is_locked boolean DEFAULT false,
  points integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT lessons_pkey PRIMARY KEY (id),
  CONSTRAINT lessons_course_id_fkey FOREIGN KEY (course_id) REFERENCES public.courses(id),
  CONSTRAINT lessons_module_id_fkey FOREIGN KEY (module_id) REFERENCES public.modules(id)
);
CREATE TABLE public.medcannlab_audit_logs (
  id bigint NOT NULL DEFAULT nextval('medcannlab_audit_logs_id_seq'::regclass),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  user_id uuid,
  action text NOT NULL,
  endpoint text,
  payload jsonb,
  ip inet,
  CONSTRAINT medcannlab_audit_logs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.medical_certificates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  professional_id uuid NOT NULL,
  certificate_type text NOT NULL CHECK (certificate_type = ANY (ARRAY['A1'::text, 'A3'::text, 'remote'::text])),
  ac_provider text NOT NULL,
  certificate_thumbprint text,
  certificate_serial_number text,
  certificate_subject text,
  expires_at timestamp with time zone NOT NULL,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT medical_certificates_pkey PRIMARY KEY (id),
  CONSTRAINT medical_certificates_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id)
);
CREATE TABLE public.messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  channel_id uuid,
  user_id uuid,
  content text NOT NULL,
  type text DEFAULT 'text'::text CHECK (type = ANY (ARRAY['text'::text, 'image'::text, 'file'::text, 'document'::text])),
  reactions jsonb DEFAULT '{}'::jsonb,
  is_pinned boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT messages_pkey PRIMARY KEY (id),
  CONSTRAINT messages_channel_id_fkey FOREIGN KEY (channel_id) REFERENCES public.channels(id)
);
CREATE TABLE public.modelos_receituario (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nome_modelo text NOT NULL,
  descricao text,
  estrutura jsonb NOT NULL,
  ativo boolean DEFAULT true,
  criado_em timestamp with time zone DEFAULT now(),
  CONSTRAINT modelos_receituario_pkey PRIMARY KEY (id)
);
CREATE TABLE public.moderator_requests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  reason text NOT NULL,
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'accepted'::text, 'declined'::text])),
  admin_response text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT moderator_requests_pkey PRIMARY KEY (id)
);
CREATE TABLE public.modules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  course_id uuid,
  title text NOT NULL,
  description text,
  order_index integer DEFAULT 0,
  duration text,
  lesson_count integer DEFAULT 0,
  is_published boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT modules_pkey PRIMARY KEY (id),
  CONSTRAINT modules_course_id_fkey FOREIGN KEY (course_id) REFERENCES public.courses(id)
);
CREATE TABLE public.news (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  summary text,
  content text,
  category text DEFAULT 'cannabis-medicinal'::text CHECK (category = ANY (ARRAY['cannabis-medicinal'::text, 'pesquisa-clinica'::text, 'metodologia-aec'::text, 'regulamentacao'::text, 'nefrologia'::text, 'clinica'::text, 'pesquisa'::text, 'farmacologia'::text])),
  author_id uuid,
  author text,
  date date DEFAULT CURRENT_DATE,
  read_time text,
  impact text CHECK (impact = ANY (ARRAY['high'::text, 'medium'::text, 'low'::text])),
  source text,
  url text,
  tags ARRAY DEFAULT '{}'::text[],
  image_url text,
  published boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT news_pkey PRIMARY KEY (id),
  CONSTRAINT news_author_id_fkey FOREIGN KEY (author_id) REFERENCES auth.users(id),
  CONSTRAINT news_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.news_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  summary text NOT NULL,
  content text,
  category text NOT NULL CHECK (category = ANY (ARRAY['cannabis-medicinal'::text, 'pesquisa-clinica'::text, 'metodologia-aec'::text, 'regulamentacao'::text, 'nefrologia'::text, 'clinica'::text, 'pesquisa'::text, 'farmacologia'::text])),
  author text NOT NULL,
  date date NOT NULL,
  read_time text,
  impact text CHECK (impact = ANY (ARRAY['high'::text, 'medium'::text, 'low'::text])),
  source text,
  url text,
  tags ARRAY DEFAULT '{}'::text[],
  image_url text,
  published boolean DEFAULT false,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT news_items_pkey PRIMARY KEY (id),
  CONSTRAINT news_items_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.noa_articles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL,
  content text NOT NULL,
  source text NOT NULL,
  author text,
  summary text,
  keywords ARRAY DEFAULT '{}'::text[],
  teaching_points ARRAY DEFAULT '{}'::text[],
  user_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT noa_articles_pkey PRIMARY KEY (id),
  CONSTRAINT noa_articles_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.noa_clinical_cases (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_initials text NOT NULL,
  chief_complaint text NOT NULL,
  history text NOT NULL,
  findings text,
  diagnosis text,
  treatment text,
  discussion_points ARRAY DEFAULT '{}'::text[],
  learning_points ARRAY DEFAULT '{}'::text[],
  user_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT noa_clinical_cases_pkey PRIMARY KEY (id),
  CONSTRAINT noa_clinical_cases_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.noa_interaction_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  session_id character varying,
  interaction_type character varying NOT NULL,
  input_data jsonb,
  output_data jsonb,
  processing_time integer,
  semantic_analysis jsonb,
  emotional_indicators jsonb,
  cognitive_insights jsonb,
  timestamp timestamp with time zone DEFAULT now(),
  success boolean DEFAULT true,
  error_message text,
  CONSTRAINT noa_interaction_logs_pkey PRIMARY KEY (id),
  CONSTRAINT noa_interaction_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.noa_lessons (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  course_title text NOT NULL,
  module_title text NOT NULL,
  lesson_title text NOT NULL,
  content text NOT NULL,
  objectives ARRAY DEFAULT '{}'::text[],
  key_concepts ARRAY DEFAULT '{}'::text[],
  practical_applications ARRAY DEFAULT '{}'::text[],
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT noa_lessons_pkey PRIMARY KEY (id)
);
CREATE TABLE public.noa_memories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  type text NOT NULL CHECK (type = ANY (ARRAY['conversation'::text, 'article'::text, 'case'::text, 'lesson'::text, 'teaching'::text])),
  title text NOT NULL,
  content text NOT NULL,
  summary text,
  keywords ARRAY DEFAULT '{}'::text[],
  context jsonb,
  user_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT noa_memories_pkey PRIMARY KEY (id),
  CONSTRAINT noa_memories_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.noa_pending_actions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  kind text NOT NULL,
  status text NOT NULL DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'consumed'::text, 'cancelled'::text, 'expired'::text])),
  candidates jsonb NOT NULL DEFAULT '[]'::jsonb,
  context jsonb NOT NULL DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  expires_at timestamp with time zone NOT NULL,
  CONSTRAINT noa_pending_actions_pkey PRIMARY KEY (id),
  CONSTRAINT noa_pending_actions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.notifications (
  id text NOT NULL,
  type text NOT NULL,
  title text NOT NULL,
  message text NOT NULL,
  data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  user_id uuid,
  user_type text CHECK (user_type = ANY (ARRAY['patient'::text, 'professional'::text, 'admin'::text])),
  is_read boolean NOT NULL DEFAULT false,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT notifications_pkey PRIMARY KEY (id)
);
CREATE TABLE public.pacientes (
  id character varying NOT NULL,
  nome character varying NOT NULL,
  idade integer NOT NULL,
  genero character varying NOT NULL CHECK (genero::text = ANY (ARRAY['masculino'::character varying, 'feminino'::character varying, 'outro'::character varying]::text[])),
  contato character varying,
  data_cadastro timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  ultima_atualizacao timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  ativo boolean DEFAULT true,
  CONSTRAINT pacientes_pkey PRIMARY KEY (id)
);
CREATE TABLE public.patient_conditions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  condition_name text NOT NULL,
  icd_code text,
  diagnosed_at date,
  status text CHECK (status = ANY (ARRAY['active'::text, 'remission'::text, 'resolved'::text])),
  notes text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT patient_conditions_pkey PRIMARY KEY (id),
  CONSTRAINT patient_conditions_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT patient_conditions_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.patient_exam_requests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  professional_id uuid NOT NULL,
  content text NOT NULL,
  status text DEFAULT 'draft'::text,
  signature_token text,
  signed_pdf_url text,
  signed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT patient_exam_requests_pkey PRIMARY KEY (id),
  CONSTRAINT patient_exam_requests_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.users(id),
  CONSTRAINT patient_exam_requests_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id)
);
CREATE TABLE public.patient_insights (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  insight_type text NOT NULL CHECK (insight_type = ANY (ARRAY['health_trend'::text, 'medication_adherence'::text, 'symptom_pattern'::text, 'lifestyle_recommendation'::text, 'treatment_effectiveness'::text, 'risk_alert'::text, 'achievement'::text, 'milestone'::text])),
  title text NOT NULL,
  description text NOT NULL,
  data jsonb,
  priority text DEFAULT 'normal'::text CHECK (priority = ANY (ARRAY['low'::text, 'normal'::text, 'high'::text, 'urgent'::text])),
  is_read boolean DEFAULT false,
  is_archived boolean DEFAULT false,
  generated_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT patient_insights_pkey PRIMARY KEY (id),
  CONSTRAINT patient_insights_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id)
);
CREATE TABLE public.patient_lab_results (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  test_type USER-DEFINED NOT NULL,
  value numeric NOT NULL,
  unit text NOT NULL,
  reference_range_min numeric,
  reference_range_max numeric,
  is_abnormal boolean DEFAULT false,
  measured_at timestamp with time zone NOT NULL DEFAULT now(),
  notes text,
  created_by uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT patient_lab_results_pkey PRIMARY KEY (id),
  CONSTRAINT patient_lab_results_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT patient_lab_results_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.patient_medical_records (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid,
  report_id text,
  record_type character varying NOT NULL DEFAULT 'chat_interaction'::character varying,
  record_data jsonb NOT NULL,
  nft_token_id character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT patient_medical_records_pkey PRIMARY KEY (id),
  CONSTRAINT patient_medical_records_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT patient_medical_records_report_id_fkey FOREIGN KEY (report_id) REFERENCES public.clinical_reports(id)
);
CREATE TABLE public.patient_prescriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  professional_id uuid,
  template_id uuid,
  plan_id uuid,
  title text NOT NULL,
  summary text,
  rationality USER-DEFINED,
  dosage text,
  frequency text,
  duration text,
  instructions text,
  indications ARRAY DEFAULT '{}'::text[],
  status USER-DEFINED NOT NULL DEFAULT 'active'::patient_prescription_status,
  issued_at timestamp with time zone NOT NULL DEFAULT now(),
  starts_at date,
  ends_at date,
  last_reviewed_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT patient_prescriptions_pkey PRIMARY KEY (id),
  CONSTRAINT patient_prescriptions_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT patient_prescriptions_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id),
  CONSTRAINT patient_prescriptions_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.integrative_prescription_templates(id),
  CONSTRAINT patient_prescriptions_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.patient_therapeutic_plans(id)
);
CREATE TABLE public.patient_therapeutic_plans (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  professional_id uuid,
  title text NOT NULL,
  summary text,
  status USER-DEFINED NOT NULL DEFAULT 'active'::patient_plan_status,
  goals jsonb DEFAULT '[]'::jsonb,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  started_at timestamp with time zone DEFAULT now(),
  completed_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT patient_therapeutic_plans_pkey PRIMARY KEY (id),
  CONSTRAINT patient_therapeutic_plans_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT patient_therapeutic_plans_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id)
);
CREATE TABLE public.permissoes_compartilhamento (
  id integer NOT NULL DEFAULT nextval('permissoes_compartilhamento_id_seq'::regclass),
  paciente_id character varying,
  dados_basicos boolean DEFAULT true,
  sintomas boolean DEFAULT false,
  medicamentos boolean DEFAULT false,
  exames boolean DEFAULT false,
  consultas boolean DEFAULT false,
  evolucao boolean DEFAULT false,
  pesquisa boolean DEFAULT false,
  validade timestamp without time zone,
  timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT permissoes_compartilhamento_pkey PRIMARY KEY (id),
  CONSTRAINT permissoes_compartilhamento_paciente_id_fkey FOREIGN KEY (paciente_id) REFERENCES public.pacientes(id)
);
CREATE TABLE public.pki_transactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  document_id uuid NOT NULL,
  signer_cpf text NOT NULL,
  signature_value text NOT NULL,
  certificate_thumbprint text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  ac_provider text,
  CONSTRAINT pki_transactions_pkey PRIMARY KEY (id),
  CONSTRAINT pki_transactions_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.cfm_prescriptions(id)
);
CREATE TABLE public.platform_params (
  key text NOT NULL,
  value jsonb NOT NULL,
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT platform_params_pkey PRIMARY KEY (key)
);
CREATE TABLE public.portal_entries (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  device_id uuid NOT NULL,
  portal_slug text NOT NULL,
  user_type text,
  email text,
  metadata jsonb NOT NULL DEFAULT '{}'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT portal_entries_pkey PRIMARY KEY (id)
);
CREATE TABLE public.prescriptions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  professional_id uuid,
  patient_id uuid,
  medication text NOT NULL,
  dosage text,
  frequency text,
  duration text,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT prescriptions_pkey PRIMARY KEY (id),
  CONSTRAINT prescriptions_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id),
  CONSTRAINT prescriptions_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id)
);
CREATE TABLE public.private_chats (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  doctor_id uuid,
  patient_id uuid,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT private_chats_pkey PRIMARY KEY (id)
);
CREATE TABLE public.private_messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  chat_id uuid,
  sender_id uuid,
  content text NOT NULL,
  type text DEFAULT 'text'::text CHECK (type = ANY (ARRAY['text'::text, 'image'::text, 'file'::text, 'document'::text])),
  attachments jsonb DEFAULT '[]'::jsonb,
  is_read boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT private_messages_pkey PRIMARY KEY (id),
  CONSTRAINT private_messages_chat_id_fkey FOREIGN KEY (chat_id) REFERENCES public.private_chats(id)
);
CREATE TABLE public.professional_availability (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  professional_id uuid NOT NULL,
  day_of_week integer NOT NULL CHECK (day_of_week >= 0 AND day_of_week <= 6),
  start_time time without time zone NOT NULL,
  end_time time without time zone NOT NULL,
  slot_duration integer DEFAULT 60 CHECK (slot_duration > 0),
  slot_interval_minutes integer,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT professional_availability_pkey PRIMARY KEY (id),
  CONSTRAINT professional_availability_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  name text,
  email text,
  type text CHECK (type = ANY (ARRAY['patient'::text, 'professional'::text, 'student'::text, 'admin'::text])),
  avatar_url text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT profiles_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ranking_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  reference_month date NOT NULL,
  total_points_earned integer DEFAULT 0,
  assessments_completed integer DEFAULT 0,
  referrals_active integer DEFAULT 0,
  global_rank_position integer,
  percentile numeric,
  tier_label text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ranking_history_pkey PRIMARY KEY (id),
  CONSTRAINT ranking_history_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.renal_exams (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid NOT NULL,
  exam_date date NOT NULL DEFAULT CURRENT_DATE,
  creatinine numeric,
  urea numeric,
  egfr numeric,
  proteinuria numeric,
  drc_stage text CHECK (drc_stage = ANY (ARRAY['G1'::text, 'G2'::text, 'G3a'::text, 'G3b'::text, 'G4'::text, 'G5'::text])),
  ai_interpretation text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  created_by uuid,
  CONSTRAINT renal_exams_pkey PRIMARY KEY (id),
  CONSTRAINT renal_exams_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id),
  CONSTRAINT renal_exams_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.role_catalog (
  role text NOT NULL,
  CONSTRAINT role_catalog_pkey PRIMARY KEY (role)
);
CREATE TABLE public.scheduling_audit_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  attempt_at timestamp with time zone DEFAULT now(),
  actor_id uuid,
  action text NOT NULL,
  request_hash text,
  professional_id uuid,
  start_time timestamp with time zone,
  status text NOT NULL,
  error_message text,
  metadata jsonb,
  CONSTRAINT scheduling_audit_log_pkey PRIMARY KEY (id),
  CONSTRAINT scheduling_audit_log_actor_id_fkey FOREIGN KEY (actor_id) REFERENCES auth.users(id)
);
CREATE TABLE public.semantic_analysis (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  chat_id uuid,
  topics ARRAY,
  emotions text,
  biomedical_terms ARRAY,
  interpretations text,
  confidence numeric DEFAULT 0.5,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT semantic_analysis_pkey PRIMARY KEY (id),
  CONSTRAINT semantic_analysis_chat_id_fkey FOREIGN KEY (chat_id) REFERENCES public.user_interactions(id)
);
CREATE TABLE public.signature_confirmations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  document_id uuid NOT NULL,
  professional_id uuid NOT NULL,
  user_confirmed_signature boolean DEFAULT false,
  confirmation_timestamp timestamp with time zone,
  document_version_hash text NOT NULL,
  ip_address text,
  user_agent text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT signature_confirmations_pkey PRIMARY KEY (id),
  CONSTRAINT signature_confirmations_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.cfm_prescriptions(id),
  CONSTRAINT signature_confirmations_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id)
);
CREATE TABLE public.smart_slot_rules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  professional_id uuid,
  rule_type text NOT NULL,
  parameters jsonb NOT NULL DEFAULT '{}'::jsonb,
  is_active boolean DEFAULT true,
  priority integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT smart_slot_rules_pkey PRIMARY KEY (id),
  CONSTRAINT smart_slot_rules_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id)
);
CREATE TABLE public.subscription_plans (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  description text,
  monthly_price numeric NOT NULL,
  annual_price numeric,
  consultation_discount integer NOT NULL,
  features jsonb DEFAULT '[]'::jsonb,
  is_remote_only boolean DEFAULT true,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT subscription_plans_pkey PRIMARY KEY (id)
);
CREATE TABLE public.system_config (
  key text NOT NULL,
  value jsonb NOT NULL,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT system_config_pkey PRIMARY KEY (key)
);
CREATE TABLE public.time_blocks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  professional_id uuid NOT NULL,
  start_at timestamp with time zone NOT NULL,
  end_at timestamp with time zone NOT NULL,
  reason text DEFAULT 'blocked'::text,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT time_blocks_pkey PRIMARY KEY (id),
  CONSTRAINT time_blocks_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id),
  CONSTRAINT time_blocks_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.transactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  amount numeric NOT NULL CHECK (amount > 0::numeric),
  currency character varying DEFAULT 'BRL'::character varying,
  description text,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['payment'::character varying, 'refund'::character varying, 'subscription'::character varying, 'bonus'::character varying]::text[])),
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'completed'::character varying, 'failed'::character varying, 'cancelled'::character varying]::text[])),
  payment_method character varying,
  payment_id text,
  gateway_response jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  appointment_id uuid,
  subscription_plan_id uuid,
  refund_reason text,
  metadata jsonb DEFAULT '{}'::jsonb,
  discount_applied numeric DEFAULT 0,
  doctor_id uuid,
  course_id uuid,
  points integer,
  kind text CHECK (kind = ANY (ARRAY['BRL'::text, 'POINTS'::text])),
  CONSTRAINT transactions_pkey PRIMARY KEY (id),
  CONSTRAINT transactions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT transactions_appointment_id_fkey FOREIGN KEY (appointment_id) REFERENCES public.appointments(id),
  CONSTRAINT transactions_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES auth.users(id),
  CONSTRAINT transactions_course_id_fkey FOREIGN KEY (course_id) REFERENCES public.courses(id)
);
CREATE TABLE public.trl_competency_domains (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  program_id uuid NOT NULL,
  name text NOT NULL,
  dimension text,
  description text,
  color text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT trl_competency_domains_pkey PRIMARY KEY (id),
  CONSTRAINT trl_competency_domains_program_id_fkey FOREIGN KEY (program_id) REFERENCES public.trl_programs(id)
);
CREATE TABLE public.trl_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  portal_entry_id uuid,
  program_id uuid,
  module_id uuid,
  lesson_id uuid,
  user_id uuid,
  event_type text NOT NULL,
  event_payload jsonb NOT NULL DEFAULT '{}'::jsonb,
  occurred_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT trl_events_pkey PRIMARY KEY (id),
  CONSTRAINT trl_events_portal_entry_id_fkey FOREIGN KEY (portal_entry_id) REFERENCES public.portal_entries(id),
  CONSTRAINT trl_events_program_id_fkey FOREIGN KEY (program_id) REFERENCES public.trl_programs(id),
  CONSTRAINT trl_events_module_id_fkey FOREIGN KEY (module_id) REFERENCES public.trl_modules(id),
  CONSTRAINT trl_events_lesson_id_fkey FOREIGN KEY (lesson_id) REFERENCES public.trl_lessons(id),
  CONSTRAINT trl_events_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.trl_learning_evidence (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  module_id uuid NOT NULL,
  title text NOT NULL,
  description text,
  evidence_type text NOT NULL CHECK (evidence_type = ANY (ARRAY['rubrica'::text, 'caso'::text, 'simulacao'::text, 'avaliacao'::text, 'projeto'::text, 'reflexao'::text])),
  due_offset_days integer,
  total_points integer CHECK (total_points IS NULL OR total_points >= 0),
  resources jsonb NOT NULL DEFAULT '[]'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT trl_learning_evidence_pkey PRIMARY KEY (id),
  CONSTRAINT trl_learning_evidence_module_id_fkey FOREIGN KEY (module_id) REFERENCES public.trl_modules(id)
);
CREATE TABLE public.trl_lessons (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  module_id uuid NOT NULL,
  title text NOT NULL,
  description text,
  format text NOT NULL CHECK (format = ANY (ARRAY['video'::text, 'reading'::text, 'lab'::text, 'avaliacao'::text, 'mentoria'::text, 'podcast'::text])),
  duration_minutes integer CHECK (duration_minutes IS NULL OR duration_minutes >= 0),
  live_at timestamp with time zone,
  release_at timestamp with time zone,
  order_index integer NOT NULL DEFAULT 1,
  is_required boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT trl_lessons_pkey PRIMARY KEY (id),
  CONSTRAINT trl_lessons_module_id_fkey FOREIGN KEY (module_id) REFERENCES public.trl_modules(id)
);
CREATE TABLE public.trl_module_competencies (
  module_id uuid NOT NULL,
  competency_id uuid NOT NULL,
  weight numeric NOT NULL DEFAULT 1 CHECK (weight > 0::numeric),
  notes text,
  CONSTRAINT trl_module_competencies_pkey PRIMARY KEY (module_id, competency_id),
  CONSTRAINT trl_module_competencies_module_id_fkey FOREIGN KEY (module_id) REFERENCES public.trl_modules(id),
  CONSTRAINT trl_module_competencies_competency_id_fkey FOREIGN KEY (competency_id) REFERENCES public.trl_competency_domains(id)
);
CREATE TABLE public.trl_modules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  program_id uuid NOT NULL,
  code text NOT NULL,
  title text NOT NULL,
  overview text,
  expected_hours integer CHECK (expected_hours IS NULL OR expected_hours >= 0),
  sequence integer NOT NULL DEFAULT 1,
  published boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT trl_modules_pkey PRIMARY KEY (id),
  CONSTRAINT trl_modules_program_id_fkey FOREIGN KEY (program_id) REFERENCES public.trl_programs(id)
);
CREATE TABLE public.trl_programs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  slug text NOT NULL UNIQUE,
  title text NOT NULL,
  coordinator_id uuid NOT NULL,
  logo_url text,
  description text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT trl_programs_pkey PRIMARY KEY (id),
  CONSTRAINT trl_programs_coordinator_id_fkey FOREIGN KEY (coordinator_id) REFERENCES auth.users(id)
);
CREATE TABLE public.trl_reflections (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  lesson_id uuid NOT NULL,
  user_id uuid NOT NULL,
  prompt text NOT NULL,
  response text NOT NULL,
  visibility text NOT NULL DEFAULT 'private'::text CHECK (visibility = ANY (ARRAY['private'::text, 'coordinator'::text, 'public'::text])),
  submitted_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT trl_reflections_pkey PRIMARY KEY (id),
  CONSTRAINT trl_reflections_lesson_id_fkey FOREIGN KEY (lesson_id) REFERENCES public.trl_lessons(id),
  CONSTRAINT trl_reflections_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.user_achievements (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  achievement_id text NOT NULL,
  title text NOT NULL,
  description text,
  icon text,
  points integer DEFAULT 0,
  category text CHECK (category = ANY (ARRAY['learning'::text, 'clinical'::text, 'social'::text, 'special'::text])),
  rarity text DEFAULT 'common'::text CHECK (rarity = ANY (ARRAY['common'::text, 'rare'::text, 'epic'::text, 'legendary'::text])),
  unlocked_at timestamp with time zone DEFAULT now(),
  progress integer DEFAULT 0,
  max_progress integer DEFAULT 1,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_achievements_pkey PRIMARY KEY (id),
  CONSTRAINT user_achievements_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.user_activity_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  activity_type text NOT NULL CHECK (activity_type = ANY (ARRAY['login'::text, 'logout'::text, 'page_view'::text, 'chat_message'::text, 'assessment_started'::text, 'assessment_completed'::text, 'document_uploaded'::text, 'prescription_issued'::text, 'appointment_scheduled'::text, 'profile_updated'::text])),
  activity_data jsonb,
  ip_address text,
  user_agent text,
  session_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_activity_logs_pkey PRIMARY KEY (id),
  CONSTRAINT user_activity_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.user_benefits_status (
  user_id uuid NOT NULL,
  is_eligible boolean DEFAULT false,
  consecutive_months_top5 integer DEFAULT 0,
  last_month_checked date,
  current_discount_percent integer DEFAULT 0,
  discount_updated_at timestamp with time zone,
  free_consultations_balance integer DEFAULT 0,
  last_consultation_grant_date date,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_benefits_status_pkey PRIMARY KEY (user_id),
  CONSTRAINT user_benefits_status_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.user_courses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  course_id uuid,
  progress numeric DEFAULT 0 CHECK (progress >= 0::numeric AND progress <= 100::numeric),
  completed_lessons integer DEFAULT 0,
  total_lessons integer DEFAULT 0,
  status character varying DEFAULT 'enrolled'::character varying CHECK (status::text = ANY (ARRAY['enrolled'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'dropped'::character varying]::text[])),
  enrolled_at timestamp with time zone DEFAULT now(),
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_courses_pkey PRIMARY KEY (id),
  CONSTRAINT user_courses_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT user_courses_course_id_fkey FOREIGN KEY (course_id) REFERENCES public.courses(id)
);
CREATE TABLE public.user_interactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id text NOT NULL,
  text_raw text NOT NULL,
  context jsonb,
  timestamp timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_interactions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_mutes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  muted_by uuid,
  reason text,
  expires_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_mutes_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_profiles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid UNIQUE,
  name text,
  avatar_url text,
  bio text,
  specialty text,
  crm text,
  cro text,
  points integer DEFAULT 0,
  level integer DEFAULT 1,
  achievements ARRAY DEFAULT '{}'::text[],
  badges ARRAY DEFAULT '{}'::text[],
  last_activity timestamp with time zone DEFAULT now(),
  total_sessions integer DEFAULT 0,
  total_time_spent integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  email character varying,
  type character varying DEFAULT 'patient'::character varying,
  avatar text,
  nft_soulbound text,
  full_name text,
  role text DEFAULT 'patient'::text,
  CONSTRAINT user_profiles_pkey PRIMARY KEY (id),
  CONSTRAINT user_profiles_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT fk_user_profiles_role_catalog FOREIGN KEY (role) REFERENCES public.role_catalog(role)
);
CREATE TABLE public.user_statistics (
  user_id uuid NOT NULL,
  total_logins integer DEFAULT 0,
  total_chat_messages integer DEFAULT 0,
  total_assessments integer DEFAULT 0,
  total_appointments integer DEFAULT 0,
  total_documents_uploaded integer DEFAULT 0,
  last_login_at timestamp with time zone,
  last_activity_at timestamp with time zone,
  experience_points integer DEFAULT 0,
  level integer DEFAULT 1,
  streak_days integer DEFAULT 0,
  last_streak_date date,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_statistics_pkey PRIMARY KEY (user_id),
  CONSTRAINT user_statistics_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.user_subscriptions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  plan_id uuid,
  status character varying DEFAULT 'active'::character varying,
  started_at timestamp with time zone DEFAULT now(),
  expires_at timestamp with time zone,
  next_billing_at timestamp with time zone,
  auto_renew boolean DEFAULT true,
  payment_method_id text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_subscriptions_pkey PRIMARY KEY (id),
  CONSTRAINT user_subscriptions_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT user_subscriptions_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.subscription_plans(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  email character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  type character varying NOT NULL DEFAULT 'patient'::character varying CHECK (type::text = ANY (ARRAY['paciente'::character varying, 'profissional'::character varying, 'aluno'::character varying, 'admin'::character varying, 'master'::character varying, 'gestor'::character varying, 'patient'::character varying, 'professional'::character varying, 'student'::character varying, 'admin'::character varying]::text[])),
  avatar text,
  nft_soulbound text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  cpf text UNIQUE,
  birth_date date,
  gender text CHECK (gender = ANY (ARRAY['male'::text, 'female'::text, 'other'::text, 'prefer_not_to_say'::text])),
  crm text,
  cro text,
  avatar_url text,
  phone text,
  address text,
  blood_type text,
  allergies text,
  medications text,
  flag_admin boolean NOT NULL DEFAULT false,
  council_type text,
  council_number text,
  council_state text,
  role text DEFAULT 'patient'::text,
  metadata jsonb,
  owner_id uuid,
  payment_status text DEFAULT 'pending'::text,
  payment_amount numeric DEFAULT 63.00,
  referral_code text UNIQUE,
  invited_by uuid,
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_invited_by_fkey FOREIGN KEY (invited_by) REFERENCES public.users(id),
  CONSTRAINT users_owner_id_fkey FOREIGN KEY (owner_id) REFERENCES auth.users(id)
);
CREATE TABLE public.usuarios (
  id character varying NOT NULL,
  nome character varying NOT NULL,
  codigo jsonb,
  nivel character varying NOT NULL CHECK (nivel::text = ANY (ARRAY['mestre'::character varying, 'admin'::character varying, 'profissional'::character varying, 'pesquisador'::character varying, 'estudante'::character varying, 'paciente'::character varying]::text[])),
  api_key character varying,
  permissoes jsonb,
  timestamp timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT usuarios_pkey PRIMARY KEY (id)
);
CREATE TABLE public.video_call_requests (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  request_id text NOT NULL UNIQUE,
  requester_id uuid NOT NULL,
  recipient_id uuid NOT NULL,
  call_type text NOT NULL CHECK (call_type = ANY (ARRAY['video'::text, 'audio'::text])),
  status text NOT NULL DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'accepted'::text, 'rejected'::text, 'expired'::text, 'cancelled'::text])),
  expires_at timestamp with time zone NOT NULL DEFAULT (now() + '00:00:30'::interval),
  accepted_at timestamp with time zone,
  rejected_at timestamp with time zone,
  cancelled_at timestamp with time zone,
  metadata jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT video_call_requests_pkey PRIMARY KEY (id),
  CONSTRAINT video_call_requests_requester_id_fkey FOREIGN KEY (requester_id) REFERENCES auth.users(id),
  CONSTRAINT video_call_requests_recipient_id_fkey FOREIGN KEY (recipient_id) REFERENCES auth.users(id)
);
CREATE TABLE public.video_call_sessions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_id text NOT NULL UNIQUE,
  professional_id uuid NOT NULL,
  patient_id uuid,
  started_at timestamp with time zone NOT NULL DEFAULT now(),
  ended_at timestamp with time zone,
  duration_seconds integer,
  call_type text NOT NULL CHECK (call_type = ANY (ARRAY['video'::text, 'audio'::text])),
  consent_snapshot jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT video_call_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT video_call_sessions_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id),
  CONSTRAINT video_call_sessions_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id)
);
CREATE TABLE public.video_clinical_snippets (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_id text NOT NULL,
  professional_id uuid NOT NULL,
  patient_id uuid NOT NULL,
  started_at timestamp with time zone NOT NULL DEFAULT now(),
  ended_at timestamp with time zone,
  duration_seconds integer NOT NULL CHECK (duration_seconds <= 300),
  purpose text NOT NULL DEFAULT 'clinical_record'::text,
  consent_snapshot jsonb NOT NULL,
  storage_path text,
  retention_policy text DEFAULT 'medical_record'::text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT video_clinical_snippets_pkey PRIMARY KEY (id),
  CONSTRAINT video_clinical_snippets_professional_id_fkey FOREIGN KEY (professional_id) REFERENCES auth.users(id),
  CONSTRAINT video_clinical_snippets_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id)
);
CREATE TABLE public.wearable_data (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  device_id uuid,
  patient_id uuid,
  data_type character varying NOT NULL,
  value numeric,
  unit character varying,
  timestamp timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT wearable_data_pkey PRIMARY KEY (id),
  CONSTRAINT wearable_data_device_id_fkey FOREIGN KEY (device_id) REFERENCES public.wearable_devices(id),
  CONSTRAINT wearable_data_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id)
);
CREATE TABLE public.wearable_devices (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  patient_id uuid,
  device_type character varying NOT NULL,
  brand character varying,
  model character varying,
  battery_level integer DEFAULT 100,
  connection_status character varying DEFAULT 'disconnected'::character varying,
  last_sync timestamp with time zone,
  data_types ARRAY DEFAULT '{}'::text[],
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT wearable_devices_pkey PRIMARY KEY (id),
  CONSTRAINT wearable_devices_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES auth.users(id)
);